# Zeabur Cron Job 排程設定說明

## 📅 排程時間設定

### 目前配置
- **執行時間**: 每週一和每週四台灣時間 00:01
- **Cron 表達式**: `1 16 * * 0,3`
  - `1`: 分鐘 (01分)
  - `16`: 小時 (16時 UTC = 00時 台灣時間)
  - `*`: 每日
  - `*`: 每月
  - `0,3`: 週日和週三 (對應台灣時間週一和週四)

### 時區說明
- Zeabur 使用 **UTC 時間**
- 台灣時間 = UTC + 8 小時
- 台灣週一 00:01 = UTC 週日 16:01
- 台灣週四 00:01 = UTC 週三 16:01

## 📁 檔案結構

```
car4/
├── zeabur.toml          # Zeabur 配置檔（包含 cron 設定）
├── cron_job.py          # 排程執行腳本
├── test_cron.py         # 測試腳本
├── app.py               # 主應用程式
└── CRON_SETUP.md        # 本說明文件
```

## 🔧 配置檔案

### zeabur.toml
```toml
[cron]
# 每週一和週四台灣時間 00:01 執行預約
# Zeabur 使用 UTC 時間，台灣時間 UTC+8
# 台灣週一 00:01 = 週日 16:01 UTC
# 台灣週四 00:01 = 週三 16:01 UTC
"1 16 * * 0,3" = "python3 cron_job.py"
```

## 🚀 部署步驟

1. **確認檔案**: 確保所有必要檔案都已上傳到 Zeabur
2. **推送代碼**: 將代碼推送到 Git 倉庫
3. **部署應用**: Zeabur 會自動讀取 zeabur.toml 並設定 cron job
4. **監控日誌**: 可以查看 `cron_reservation.log` 了解執行狀況

## 🧪 本地測試

執行測試腳本確認功能正常：
```bash
python3 test_cron.py
```

直接測試 cron job 腳本：
```bash
python3 cron_job.py
```

## 📊 日誌監控

- **日誌檔案**: `cron_reservation.log`
- **日誌內容**: 包含執行時間、成功/失敗狀態、錯誤訊息
- **查看方式**: 透過 Zeabur 控制台或檔案系統存取

## ⚙️ 自訂時間設定

如需修改執行時間，請編輯 `zeabur.toml` 中的 cron 表達式：

### 常用時間設定範例

```toml
# 每天台灣時間 00:01
"1 16 * * *" = "python3 cron_job.py"

# 每週一台灣時間 00:01
"1 16 * * 0" = "python3 cron_job.py"

# 每月1日台灣時間 00:01
"1 16 1 * *" = "python3 cron_job.py"
```

### Cron 表達式格式
```
分鐘 小時 日 月 週
 |   |   |  |  |
 |   |   |  |  +-- 週幾 (0=週日, 1=週一, ..., 6=週六)
 |   |   |  +---- 月份 (1-12)
 |   |   +------ 日期 (1-31)
 |   +---------- 小時 (0-23, UTC)
 +-------------- 分鐘 (0-59)
```

## ⚠️ 注意事項

1. **時區轉換**: 記住 Zeabur 使用 UTC 時間
2. **執行權限**: 確保 `cron_job.py` 有執行權限
3. **依賴套件**: 確保所有必要的 Python 套件都已安裝
4. **錯誤處理**: cron job 會記錄錯誤日誌，便於除錯
5. **資源限制**: 注意 Zeabur 的 cron job 執行時間限制

## 🔄 修改排程

如需修改排程時間：

1. 編輯 `zeabur.toml` 中的 cron 設定
2. 提交並推送代碼
3. Zeabur 會自動更新 cron job 設定

## 📞 故障排除

### 常見問題

1. **Cron job 沒有執行**
   - 檢查 zeabur.toml 語法是否正確
   - 確認時區轉換是否正確
   - 查看 Zeabur 控制台的錯誤日誌

2. **執行失敗**
   - 檢查 `cron_reservation.log` 日誌
   - 確認 `cron_job.py` 的導入路徑正確
   - 驗證所有依賴是否安裝

3. **時間不對**
   - 再次確認 UTC 和台灣時間的轉換
   - 使用 cron 表達式測試工具驗證

### 測試建議

- 先設定短間隔時間進行測試（如每5分鐘）
- 確認功能正常後再改為正式時間
- 定期檢查日誌確保排程正常執行 